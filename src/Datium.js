(function(){
/// <reference path="OptionSanitizer.ts" />
/// <reference path="FormatBlocks.ts" />
/// <reference path="DatePart.ts" />
/// <reference path="DisplayParser.ts" />
window['Datium'] = (function () {
    var options;
    return (function () {
        function class_1(opts) {
            this.updateOptions(opts);
        }
        class_1.prototype.updateOptions = function (opts) {
            options = OptionSanitizer.sanitize(opts);
        };
        return class_1;
    })();
})();
var Selection = (function () {
    function Selection(start, end) {
        this.start = start;
        this.end = end;
    }
    return Selection;
})();
var DatepickerInput = (function () {
    function DatepickerInput(element, displayAs, minDate, maxDate) {
        this.element = element;
        this.minDate = minDate;
        this.maxDate = maxDate;
        this.shiftTabDown = false;
        this.tabDown = false;
        this.pasting = false;
        this.textBuffer = '';
        this.keyMap = {
            '48': '0', '96': '0', '49': '1', '97': '1',
            '50': '2', '98': '2', '51': '3', '99': '3',
            '52': '4', '100': '4', '53': '5', '101': '5',
            '54': '6', '102': '6', '55': '7', '103': '7',
            '56': '8', '104': '8', '57': '9', '105': '9',
            '65': 'a', '66': 'b', '67': 'c', '68': 'd',
            '69': 'e', '70': 'f', '71': 'g', '72': 'h',
            '73': 'i', '74': 'j', '75': 'k', '76': 'l',
            '77': 'm', '78': 'n', '79': 'o', '80': 'p',
            '81': 'q', '82': 'r', '83': 's', '84': 't',
            '85': 'u', '86': 'v', '87': 'w', '88': 'x',
            '89': 'y', '90': 'z'
        };
        this.selecting = false;
        this.dateParts = DisplayParser.parse(displayAs);
        this.dateStringRegExp = this.concatRegExp(this.dateParts);
        this.bindEvents();
        this.element.setAttribute('spellcheck', 'false');
        this.update(new Date());
    }
    DatepickerInput.prototype.concatRegExp = function (dateParts) {
        var regExp = '';
        dateParts.forEach(function (datePart) {
            regExp += datePart.getRegExpString();
        });
        return new RegExp("^" + regExp + "$", 'i');
    };
    DatepickerInput.prototype.bindEvents = function () {
        var _this = this;
        this.element.addEventListener('focus', function () { return _this.focus(); });
        this.element.addEventListener('keydown', function (e) { return _this.keydown(e); });
        this.element.addEventListener('paste', function () { return _this.paste(); });
        document.addEventListener('keydown', function (e) {
            if (e.shiftKey && e.keyCode === 9 /* TAB */) {
                _this.shiftTabDown = true;
            }
            else if (e.keyCode === 9 /* TAB */) {
                _this.tabDown = true;
            }
            setTimeout(function () {
                _this.shiftTabDown = false;
                _this.tabDown = false;
            });
        });
        // Prevent Default
        this.element.addEventListener('dragenter', function (e) { return e.preventDefault(); });
        this.element.addEventListener('dragover', function (e) { return e.preventDefault(); });
        this.element.addEventListener('drop', function (e) { return e.preventDefault(); });
        this.element.addEventListener('cut', function (e) { return e.preventDefault(); });
        var caretStart;
        var down = false;
        var mousedown = function () {
            clearInterval(interval);
            down = true;
            _this.element.setSelectionRange(void 0, void 0);
            setTimeout(function () {
                caretStart = _this.element.selectionStart;
            });
        };
        var mouseup = function () {
            if (!down)
                return;
            down = false;
            var pos = _this.element.selectionStart === caretStart ? _this.element.selectionEnd : _this.element.selectionStart;
            _this.selectedIndex = _this.getNearestSelectableIndex(pos);
            if (_this.element.selectionStart > 0 || _this.element.selectionEnd < _this.element.value.length) {
                _this.update();
            }
        };
        var touchstart = function () {
            _this.element.removeEventListener('mousedown', mousedown);
            document.removeEventListener('mouseup', mouseup);
            document.removeEventListener('touchstart', touchstart);
        };
        this.element.addEventListener('mousedown', mousedown);
        document.addEventListener('mouseup', mouseup);
        document.addEventListener('touchstart', touchstart);
        var lastStart;
        var lastEnd;
        var interval = setInterval(function () {
            if (!_this.pasting &&
                (_this.element.selectionStart !== 0 ||
                    _this.element.selectionEnd !== _this.element.value.length) &&
                (_this.element.selectionStart !== lastStart ||
                    _this.element.selectionEnd !== lastEnd)) {
                _this.selectedIndex = _this.getNearestSelectableIndex(_this.element.selectionStart + (_this.element.selectionEnd - _this.element.selectionStart) / 2);
                _this.update();
            }
            lastStart = _this.element.selectionStart;
            lastEnd = _this.element.selectionEnd;
        });
    };
    DatepickerInput.prototype.paste = function () {
        var _this = this;
        this.pasting = true;
        var originalValue = this.element.value;
        setTimeout(function () {
            if (!_this.dateStringRegExp.test(_this.element.value)) {
                _this.element.value = originalValue;
                _this.pasting = false;
                return;
            }
            var newDate = new Date(_this.curDate.valueOf());
            var strPrefix = '';
            _this.dateParts.forEach(function (datePart) {
                var val = _this.element.value.replace(strPrefix, '').match(datePart.getRegExpString())[0];
                strPrefix += val;
                if (!datePart.isSelectable())
                    return;
                newDate = datePart.getDateFromString(newDate, val);
            });
            _this.update(newDate);
            _this.pasting = false;
        });
    };
    DatepickerInput.prototype.keydown = function (e) {
        if ((e.keyCode === 36 /* HOME */ || e.keyCode === 35 /* END */) && e.shiftKey)
            return;
        if (e.keyCode === 67 /* C */ && e.ctrlKey)
            return;
        if (e.keyCode === 65 /* A */ && e.ctrlKey)
            return;
        if (e.keyCode === 86 /* V */ && e.ctrlKey)
            return;
        if ((e.keyCode === 37 /* LEFT */ || e.keyCode === 39 /* RIGHT */) && e.shiftKey)
            return;
        if (e.keyCode === 36 /* HOME */) {
            this.selectedIndex = this.getFirstSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.keyCode === 35 /* END */) {
            this.selectedIndex = this.getLastSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.keyCode === 37 /* LEFT */) {
            this.selectedIndex = this.getPreviousSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.shiftKey && e.keyCode === 9 /* TAB */) {
            var previousSelectable = this.getPreviousSelectable();
            if (previousSelectable !== this.selectedIndex) {
                this.selectedIndex = previousSelectable;
                this.update();
                e.preventDefault();
            }
        }
        else if (e.keyCode === 39 /* RIGHT */) {
            this.selectedIndex = this.getNextSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.keyCode === 9 /* TAB */) {
            var nextSelectable = this.getNextSelectable();
            if (nextSelectable !== this.selectedIndex) {
                this.selectedIndex = nextSelectable;
                this.update();
                e.preventDefault();
            }
        }
        else if (e.keyCode === 38 /* UP */) {
            var newDate = this.dateParts[this.selectedIndex].increment(this.curDate);
            this.update(newDate);
            e.preventDefault();
        }
        else if (e.keyCode === 40 /* DOWN */) {
            var newDate = this.dateParts[this.selectedIndex].decrement(this.curDate);
            this.update(newDate);
            e.preventDefault();
        }
        else {
            e.preventDefault();
        }
        var keyPressed = this.keyMap[e.keyCode];
        if (e.keyCode === 8 /* BACKSPACE */) {
            this.backspace();
        }
        else if (keyPressed !== void 0) {
            this.textBuffer += keyPressed;
        }
        else if (!e.shiftKey) {
            this.textBuffer = '';
        }
        if (this.textBuffer.length > 0) {
            var orig = this.curDate.valueOf();
            var result = this.dateParts[this.selectedIndex].getDateFromString(this.curDate, this.textBuffer);
            if (result !== void 0 && this.dateParts[this.selectedIndex].getMaxBufferSize(result) !== void 0 && this.textBuffer.length >= this.dateParts[this.selectedIndex].getMaxBufferSize(result)) {
                this.selectedIndex = this.getNextSelectable();
            }
            if (result === void 0) {
                this.textBuffer = this.textBuffer.slice(0, this.textBuffer.length - 1);
            }
            else {
                this.update(result);
            }
        }
    };
    DatepickerInput.prototype.backspace = function () {
        if (this.textBuffer.length < 2) {
            var orig = this.curDate.valueOf();
            var result = this.dateParts[this.selectedIndex].getDateFromString(this.curDate, 'ZERO_OUT');
            if (result.valueOf() !== orig) {
                this.update(result);
            }
        }
        this.textBuffer = this.textBuffer.slice(0, this.textBuffer.length - 1);
    };
    DatepickerInput.prototype.getPreviousSelectable = function () {
        var index = this.selectedIndex;
        while (--index >= 0) {
            if (this.dateParts[index].isSelectable())
                return index;
        }
        return this.selectedIndex;
    };
    DatepickerInput.prototype.getNextSelectable = function () {
        var index = this.selectedIndex;
        while (++index < this.dateParts.length) {
            if (this.dateParts[index].isSelectable())
                return index;
        }
        return this.selectedIndex;
    };
    DatepickerInput.prototype.getNearestSelectableIndex = function (caretPosition) {
        var pos = 0;
        var nearestSelectableIndex;
        var nearestSelectableDistance;
        for (var i = 0; i < this.dateParts.length; i++) {
            if (this.dateParts[i].isSelectable()) {
                var fromLeft = caretPosition - pos;
                var fromRight = caretPosition - (pos + this.dateParts[i].toString().length);
                if (fromLeft > 0 && fromRight < 0)
                    return i;
                var dist = Math.min(Math.abs(fromLeft), Math.abs(fromRight));
                if (nearestSelectableIndex == void 0 || dist <= nearestSelectableDistance) {
                    nearestSelectableIndex = i;
                    nearestSelectableDistance = dist;
                }
            }
            pos += this.dateParts[i].toString().length;
        }
        return nearestSelectableIndex;
    };
    DatepickerInput.prototype.focus = function () {
        var _this = this;
        if (this.tabDown) {
            this.selectedIndex = this.getFirstSelectable();
            setTimeout(function () {
                _this.update();
            });
        }
        else if (this.shiftTabDown) {
            this.selectedIndex = this.getLastSelectable();
            setTimeout(function () {
                _this.update();
            });
        }
    };
    DatepickerInput.prototype.getFirstSelectable = function () {
        for (var i = 0; i < this.dateParts.length; i++) {
            if (this.dateParts[i].isSelectable())
                return i;
        }
        return void 0;
    };
    DatepickerInput.prototype.getLastSelectable = function () {
        for (var i = this.dateParts.length - 1; i >= 0; i--) {
            if (this.dateParts[i].isSelectable())
                return i;
        }
        return void 0;
    };
    DatepickerInput.prototype.update = function (date) {
        if (date === void 0)
            date = this.curDate;
        if (this.minDate !== void 0 && date.valueOf() < this.minDate.valueOf())
            date = new Date(this.minDate.valueOf());
        if (this.maxDate !== void 0 && date.valueOf() < this.maxDate.valueOf())
            date = new Date(this.maxDate.valueOf());
        if (this.selectedIndex !== this.lastSelectedIndex) {
            this.textBuffer = '';
        }
        this.lastSelectedIndex = this.selectedIndex;
        this.curDate = new Date(date.valueOf());
        var dateString = '';
        this.dateParts.forEach(function (datePart) {
            dateString += datePart.setValue(date).toString();
        });
        this.element.value = dateString;
        this.updateSelection();
    };
    DatepickerInput.prototype.updateSelection = function () {
        if (this.selectedIndex === void 0 || document.activeElement !== this.element)
            return;
        var start = 0;
        for (var i = 0; i < this.selectedIndex; i++) {
            start += this.dateParts[i].toString().length;
        }
        var end = start + this.dateParts[this.selectedIndex].toString().length;
        this.element.setSelectionRange(start, end);
    };
    return DatepickerInput;
})();
exports["default"] = DatepickerInput;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRhdGl1bS50cyJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsInVwZGF0ZU9wdGlvbnMiLCJTZWxlY3Rpb24iLCJTZWxlY3Rpb24uY29uc3RydWN0b3IiLCJEYXRlcGlja2VySW5wdXQiLCJEYXRlcGlja2VySW5wdXQuY29uc3RydWN0b3IiLCJEYXRlcGlja2VySW5wdXQuY29uY2F0UmVnRXhwIiwiRGF0ZXBpY2tlcklucHV0LmJpbmRFdmVudHMiLCJEYXRlcGlja2VySW5wdXQucGFzdGUiLCJEYXRlcGlja2VySW5wdXQua2V5ZG93biIsIkRhdGVwaWNrZXJJbnB1dC5iYWNrc3BhY2UiLCJEYXRlcGlja2VySW5wdXQuZ2V0UHJldmlvdXNTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LmdldE5leHRTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LmdldE5lYXJlc3RTZWxlY3RhYmxlSW5kZXgiLCJEYXRlcGlja2VySW5wdXQuZm9jdXMiLCJEYXRlcGlja2VySW5wdXQuZ2V0Rmlyc3RTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LmdldExhc3RTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LnVwZGF0ZSIsIkRhdGVwaWNrZXJJbnB1dC51cGRhdGVTZWxlY3Rpb24iXSwibWFwcGluZ3MiOiJBQUFBLDJDQUEyQztBQUMzQyx3Q0FBd0M7QUFDeEMsb0NBQW9DO0FBQ3BDLHlDQUF5QztBQUVuQyxNQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQztJQUN2QixJQUFJLE9BQWdCLENBQUM7SUFFckIsTUFBTSxDQUFDO1FBQ0gsaUJBQVksSUFBYTtZQUNyQkEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLENBQUNBO1FBRUQsK0JBQWEsR0FBYixVQUFjLElBQWE7WUFDdkJDLE9BQU9BLEdBQUdBLGVBQWVBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzdDQSxDQUFDQTtRQUNMLGNBQUM7SUFBRCxDQVJPLEFBUU4sR0FBQSxDQUFBO0FBQ0wsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQVFMO0lBQ0lDLG1CQUFtQkEsS0FBWUEsRUFBU0EsR0FBVUE7UUFBL0JDLFVBQUtBLEdBQUxBLEtBQUtBLENBQU9BO1FBQVNBLFFBQUdBLEdBQUhBLEdBQUdBLENBQU9BO0lBQUdBLENBQUNBO0lBQzFERCxnQkFBQ0E7QUFBREEsQ0FGQSxBQUVDQSxJQUFBO0FBRUQ7SUFPSUUseUJBQW9CQSxPQUF3QkEsRUFBRUEsU0FBZ0JBLEVBQVVBLE9BQWFBLEVBQVVBLE9BQWFBO1FBQXhGQyxZQUFPQSxHQUFQQSxPQUFPQSxDQUFpQkE7UUFBNEJBLFlBQU9BLEdBQVBBLE9BQU9BLENBQU1BO1FBQVVBLFlBQU9BLEdBQVBBLE9BQU9BLENBQU1BO1FBd0ZwR0EsaUJBQVlBLEdBQUdBLEtBQUtBLENBQUNBO1FBQ3JCQSxZQUFPQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUNoQkEsWUFBT0EsR0FBV0EsS0FBS0EsQ0FBQ0E7UUF3QnhCQSxlQUFVQSxHQUFVQSxFQUFFQSxDQUFDQTtRQXNGdkJBLFdBQU1BLEdBQW9CQTtZQUM5QkEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0E7WUFDMUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBO1lBQzFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxLQUFLQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxLQUFLQSxFQUFFQSxHQUFHQTtZQUM1Q0EsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsS0FBS0EsRUFBRUEsR0FBR0E7WUFDNUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLEdBQUdBO1lBQzVDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQTtZQUMxQ0EsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0E7WUFDMUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBO1lBQzFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQTtZQUMxQ0EsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0E7WUFDMUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBO1lBQzFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQTtTQUN2QkEsQ0FBQUE7UUFrQk9BLGNBQVNBLEdBQVdBLEtBQUtBLENBQUNBO1FBdE85QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsYUFBYUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDaERBLElBQUlBLENBQUNBLGdCQUFnQkEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FB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Q0EsQ0FBQ0EsY0FBY0EsRUFBRUEsQ0FBQ0E7UUFDdkJBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ0pBLENBQUNBLENBQUNBLGNBQWNBLEVBQUVBLENBQUNBO1FBQ3ZCQSxDQUFDQTtRQUVEQSxJQUFJQSxVQUFVQSxHQUFRQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUU3Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsS0FBS0EsaUJBQWtCQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNuQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7UUFDckJBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLFVBQVVBLEtBQUtBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQy9CQSxJQUFJQSxDQUFDQSxVQUFVQSxJQUFJQSxVQUFVQSxDQUFDQTtRQUNsQ0EsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDckJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ3pCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDbENBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0E7WUFDakdBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEtBQUtBLEtBQUtBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsS0FBS0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsSUFBSUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDdkxBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0E7WUFDbERBLENBQUNBO1lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEtBQUtBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNwQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0VBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNKQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUN4QkEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFFT0wsbUNBQVNBLEdBQWpCQTtRQUNJTSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDbENBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlB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Q0FBQ0EsYUFBYUEsS0FBS0EsS0FBS0EsQ0FBQ0EsSUFBSUEsUUFBUUEsQ0FBQ0EsYUFBYUEsS0FBS0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7WUFBQ0EsTUFBTUEsQ0FBQ0E7UUFDckZBLElBQUlBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2RBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNqREEsQ0FBQ0E7UUFDREEsSUFBSUEsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDdkVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLGlCQUFpQkEsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDL0NBLENBQUNBO0lBQ0xkLHNCQUFDQTtBQUFEQSxDQWhVQSxBQWdVQ0EsSUFBQTtBQWhVRCxvQ0FnVUMsQ0FBQSIsImZpbGUiOiJjOi9Qcm9qZWN0cy9kYXRpdW0vc3JjL0RhdGl1bS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJPcHRpb25TYW5pdGl6ZXIudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiRm9ybWF0QmxvY2tzLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkRhdGVQYXJ0LnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkRpc3BsYXlQYXJzZXIudHNcIiAvPlxyXG5cclxuKDxhbnk+d2luZG93KVsnRGF0aXVtJ10gPSAoZnVuY3Rpb24oKSB7XHJcbiAgICBsZXQgb3B0aW9uczpJT3B0aW9ucztcclxuICAgIFxyXG4gICAgcmV0dXJuIGNsYXNzIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihvcHRzOklPcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyhvcHRzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdXBkYXRlT3B0aW9ucyhvcHRzOklPcHRpb25zKTp2b2lkIHtcclxuICAgICAgICAgICAgb3B0aW9ucyA9IE9wdGlvblNhbml0aXplci5zYW5pdGl6ZShvcHRzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG5leHBvcnQgY29uc3QgZW51bSBLZXlDb2RlcyB7XHJcbiAgICBSSUdIVCA9IDM5LCBMRUZUID0gMzcsIFRBQiA9IDksIFVQID0gMzgsXHJcbiAgICBET1dOID0gNDAsIFYgPSA4NiwgQyA9IDY3LCBBID0gNjUsIEhPTUUgPSAzNixcclxuICAgIEVORCA9IDM1LCBCQUNLU1BBQ0UgPSA4XHJcbn1cclxuXHJcbmNsYXNzIFNlbGVjdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgc3RhcnQ6bnVtYmVyLCBwdWJsaWMgZW5kOm51bWJlcikge31cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGF0ZXBpY2tlcklucHV0IHtcclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdGVkSW5kZXg6bnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBjdXJEYXRlOkRhdGU7XHJcbiAgICBwcml2YXRlIGRhdGVQYXJ0czpEYXRlUGFydFtdO1xyXG4gICAgcHJpdmF0ZSBkYXRlU3RyaW5nUmVnRXhwOlJlZ0V4cDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6SFRNTElucHV0RWxlbWVudCwgZGlzcGxheUFzOnN0cmluZywgcHJpdmF0ZSBtaW5EYXRlPzpEYXRlLCBwcml2YXRlIG1heERhdGU/OkRhdGUpIHtcclxuICAgICAgICB0aGlzLmRhdGVQYXJ0cyA9IERpc3BsYXlQYXJzZXIucGFyc2UoZGlzcGxheUFzKTtcclxuICAgICAgICB0aGlzLmRhdGVTdHJpbmdSZWdFeHAgPSB0aGlzLmNvbmNhdFJlZ0V4cCh0aGlzLmRhdGVQYXJ0cyk7XHJcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKCk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnc3BlbGxjaGVjaycsICdmYWxzZScpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlKG5ldyBEYXRlKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29uY2F0UmVnRXhwKGRhdGVQYXJ0czpEYXRlUGFydFtdKTpSZWdFeHAge1xyXG4gICAgICAgIGxldCByZWdFeHAgPSAnJztcclxuICAgICAgICBkYXRlUGFydHMuZm9yRWFjaCgoZGF0ZVBhcnQpID0+IHtcclxuICAgICAgICAgICByZWdFeHAgKz0gZGF0ZVBhcnQuZ2V0UmVnRXhwU3RyaW5nKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoYF4ke3JlZ0V4cH0kYCwgJ2knKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJpbmRFdmVudHMoKTp2b2lkIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiB0aGlzLmZvY3VzKCkpO1xyXG5cclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB0aGlzLmtleWRvd24oZSkpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdwYXN0ZScsICgpID0+IHRoaXMucGFzdGUoKSk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZTpLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5ICYmIGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuVEFCKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNoaWZ0VGFiRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5UQUIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFiRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgIHRoaXMuc2hpZnRUYWJEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgIHRoaXMudGFiRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBQcmV2ZW50IERlZmF1bHRcclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VudGVyJywgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCAoZSkgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY3V0JywgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcblxyXG4gICAgICAgIGxldCBjYXJldFN0YXJ0Om51bWJlcjtcclxuICAgICAgICBsZXQgZG93biA9IGZhbHNlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBtb3VzZWRvd24gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xyXG4gICAgICAgICAgICBkb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNldFNlbGVjdGlvblJhbmdlKHZvaWQgMCwgdm9pZCAwKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjYXJldFN0YXJ0ID0gdGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBtb3VzZXVwID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWRvd24pIHJldHVybjtcclxuICAgICAgICAgICAgZG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICBsZXQgcG9zID0gdGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0ID09PSBjYXJldFN0YXJ0ID8gdGhpcy5lbGVtZW50LnNlbGVjdGlvbkVuZCA6IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25TdGFydDtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gdGhpcy5nZXROZWFyZXN0U2VsZWN0YWJsZUluZGV4KHBvcyk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuc2VsZWN0aW9uU3RhcnQgPiAwIHx8IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25FbmQgPCB0aGlzLmVsZW1lbnQudmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgdG91Y2hzdGFydCA9ICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG1vdXNlZG93bik7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBtb3VzZXVwKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRvdWNoc3RhcnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgbW91c2Vkb3duKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgbW91c2V1cCk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRvdWNoc3RhcnQpO1xyXG5cclxuICAgICAgICBsZXQgbGFzdFN0YXJ0Om51bWJlcjtcclxuICAgICAgICBsZXQgbGFzdEVuZDpudW1iZXI7XHJcbiAgICAgICAgbGV0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucGFzdGluZyAmJlxyXG4gICAgICAgICAgICAgICAgKHRoaXMuZWxlbWVudC5zZWxlY3Rpb25TdGFydCAhPT0gMCB8fFxyXG4gICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zZWxlY3Rpb25FbmQgIT09IHRoaXMuZWxlbWVudC52YWx1ZS5sZW5ndGgpICYmXHJcbiAgICAgICAgICAgICAgICAodGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0ICE9PSBsYXN0U3RhcnQgfHxcclxuICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc2VsZWN0aW9uRW5kICE9PSBsYXN0RW5kKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gdGhpcy5nZXROZWFyZXN0U2VsZWN0YWJsZUluZGV4KHRoaXMuZWxlbWVudC5zZWxlY3Rpb25TdGFydCArICh0aGlzLmVsZW1lbnQuc2VsZWN0aW9uRW5kIC0gdGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0KSAvIDIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxhc3RTdGFydCA9IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25TdGFydDtcclxuICAgICAgICAgICAgbGFzdEVuZCA9IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25FbmQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHByaXZhdGUgc2hpZnRUYWJEb3duID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIHRhYkRvd24gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgcGFzdGluZzpib29sZWFuID0gZmFsc2U7XHJcbiAgICBcclxuICAgIHByaXZhdGUgcGFzdGUoKTp2b2lkIHtcclxuICAgICAgICB0aGlzLnBhc3RpbmcgPSB0cnVlO1xyXG4gICAgICAgIGxldCBvcmlnaW5hbFZhbHVlID0gdGhpcy5lbGVtZW50LnZhbHVlO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGF0ZVN0cmluZ1JlZ0V4cC50ZXN0KHRoaXMuZWxlbWVudC52YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC52YWx1ZSA9IG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhc3RpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgbmV3RGF0ZSA9IG5ldyBEYXRlKHRoaXMuY3VyRGF0ZS52YWx1ZU9mKCkpO1xyXG4gICAgICAgICAgICBsZXQgc3RyUHJlZml4ID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0ZVBhcnRzLmZvckVhY2goKGRhdGVQYXJ0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsID0gdGhpcy5lbGVtZW50LnZhbHVlLnJlcGxhY2Uoc3RyUHJlZml4LCAnJykubWF0Y2goZGF0ZVBhcnQuZ2V0UmVnRXhwU3RyaW5nKCkpWzBdO1xyXG4gICAgICAgICAgICAgICAgc3RyUHJlZml4ICs9IHZhbDtcclxuICAgICAgICAgICAgICAgIGlmICghZGF0ZVBhcnQuaXNTZWxlY3RhYmxlKCkpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIG5ld0RhdGUgPSBkYXRlUGFydC5nZXREYXRlRnJvbVN0cmluZyhuZXdEYXRlLCB2YWwpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGUobmV3RGF0ZSk7XHJcbiAgICAgICAgICAgIHRoaXMucGFzdGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdGV4dEJ1ZmZlcjpzdHJpbmcgPSAnJztcclxuXHJcbiAgICBwcml2YXRlIGtleWRvd24oZTpLZXlib2FyZEV2ZW50KTp2b2lkIHtcclxuICAgICAgICBpZiAoKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuSE9NRSB8fCBlLmtleUNvZGUgPT09IEtleUNvZGVzLkVORCkgJiYgZS5zaGlmdEtleSkgcmV0dXJuO1xyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGVzLkMgJiYgZS5jdHJsS2V5KSByZXR1cm47XHJcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuQSAmJiBlLmN0cmxLZXkpIHJldHVybjtcclxuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5WICYmIGUuY3RybEtleSkgcmV0dXJuO1xyXG4gICAgICAgIGlmICgoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5MRUZUIHx8IGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuUklHSFQpICYmIGUuc2hpZnRLZXkpIHJldHVybjtcclxuXHJcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuSE9NRSkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldEZpcnN0U2VsZWN0YWJsZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGVzLkVORCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldExhc3RTZWxlY3RhYmxlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuTEVGVCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldFByZXZpb3VzU2VsZWN0YWJsZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLnNoaWZ0S2V5ICYmIGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuVEFCKSB7XHJcbiAgICAgICAgICAgIGxldCBwcmV2aW91c1NlbGVjdGFibGUgPSB0aGlzLmdldFByZXZpb3VzU2VsZWN0YWJsZSgpO1xyXG4gICAgICAgICAgICBpZiAocHJldmlvdXNTZWxlY3RhYmxlICE9PSB0aGlzLnNlbGVjdGVkSW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHByZXZpb3VzU2VsZWN0YWJsZTtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuUklHSFQpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gdGhpcy5nZXROZXh0U2VsZWN0YWJsZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGVzLlRBQikge1xyXG4gICAgICAgICAgICBsZXQgbmV4dFNlbGVjdGFibGUgPSB0aGlzLmdldE5leHRTZWxlY3RhYmxlKCk7XHJcbiAgICAgICAgICAgIGlmIChuZXh0U2VsZWN0YWJsZSAhPT0gdGhpcy5zZWxlY3RlZEluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSBuZXh0U2VsZWN0YWJsZTtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuVVApIHtcclxuICAgICAgICAgICAgbGV0IG5ld0RhdGUgPSB0aGlzLmRhdGVQYXJ0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmluY3JlbWVudCh0aGlzLmN1ckRhdGUpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZShuZXdEYXRlKTtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5ET1dOKSB7XHJcbiAgICAgICAgICAgIGxldCBuZXdEYXRlID0gdGhpcy5kYXRlUGFydHNbdGhpcy5zZWxlY3RlZEluZGV4XS5kZWNyZW1lbnQodGhpcy5jdXJEYXRlKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGUobmV3RGF0ZSk7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQga2V5UHJlc3NlZCA9IDxhbnk+dGhpcy5rZXlNYXBbZS5rZXlDb2RlXTtcclxuXHJcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuQkFDS1NQQUNFKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmFja3NwYWNlKCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChrZXlQcmVzc2VkICE9PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgdGhpcy50ZXh0QnVmZmVyICs9IGtleVByZXNzZWQ7XHJcbiAgICAgICAgfSBlbHNlIGlmICghZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICB0aGlzLnRleHRCdWZmZXIgPSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnRleHRCdWZmZXIubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBsZXQgb3JpZyA9IHRoaXMuY3VyRGF0ZS52YWx1ZU9mKCk7XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0aGlzLmRhdGVQYXJ0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmdldERhdGVGcm9tU3RyaW5nKHRoaXMuY3VyRGF0ZSwgdGhpcy50ZXh0QnVmZmVyKTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gdm9pZCAwICYmIHRoaXMuZGF0ZVBhcnRzW3RoaXMuc2VsZWN0ZWRJbmRleF0uZ2V0TWF4QnVmZmVyU2l6ZShyZXN1bHQpICE9PSB2b2lkIDAgJiYgdGhpcy50ZXh0QnVmZmVyLmxlbmd0aCA+PSB0aGlzLmRhdGVQYXJ0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmdldE1heEJ1ZmZlclNpemUocmVzdWx0KSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gdGhpcy5nZXROZXh0U2VsZWN0YWJsZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0QnVmZmVyID0gdGhpcy50ZXh0QnVmZmVyLnNsaWNlKDAsIHRoaXMudGV4dEJ1ZmZlci5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiYWNrc3BhY2UoKTp2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy50ZXh0QnVmZmVyLmxlbmd0aCA8IDIpIHtcclxuICAgICAgICAgICAgbGV0IG9yaWcgPSB0aGlzLmN1ckRhdGUudmFsdWVPZigpO1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5kYXRlUGFydHNbdGhpcy5zZWxlY3RlZEluZGV4XS5nZXREYXRlRnJvbVN0cmluZyh0aGlzLmN1ckRhdGUsICdaRVJPX09VVCcpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlT2YoKSAhPT0gb3JpZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGUocmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRleHRCdWZmZXIgPSB0aGlzLnRleHRCdWZmZXIuc2xpY2UoMCwgdGhpcy50ZXh0QnVmZmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUga2V5TWFwOnt9ID0gPFtrZXk6c3RyaW5nXT57XHJcbiAgICAgICAgJzQ4JzogJzAnLCAnOTYnOiAnMCcsICc0OSc6ICcxJywgJzk3JzogJzEnLFxyXG4gICAgICAgICc1MCc6ICcyJywgJzk4JzogJzInLCAnNTEnOiAnMycsICc5OSc6ICczJyxcclxuICAgICAgICAnNTInOiAnNCcsICcxMDAnOiAnNCcsICc1Myc6ICc1JywgJzEwMSc6ICc1JyxcclxuICAgICAgICAnNTQnOiAnNicsICcxMDInOiAnNicsICc1NSc6ICc3JywgJzEwMyc6ICc3JyxcclxuICAgICAgICAnNTYnOiAnOCcsICcxMDQnOiAnOCcsICc1Nyc6ICc5JywgJzEwNSc6ICc5JyxcclxuICAgICAgICAnNjUnOiAnYScsICc2Nic6ICdiJywgJzY3JzogJ2MnLCAnNjgnOiAnZCcsXHJcbiAgICAgICAgJzY5JzogJ2UnLCAnNzAnOiAnZicsICc3MSc6ICdnJywgJzcyJzogJ2gnLFxyXG4gICAgICAgICc3Myc6ICdpJywgJzc0JzogJ2onLCAnNzUnOiAnaycsICc3Nic6ICdsJyxcclxuICAgICAgICAnNzcnOiAnbScsICc3OCc6ICduJywgJzc5JzogJ28nLCAnODAnOiAncCcsXHJcbiAgICAgICAgJzgxJzogJ3EnLCAnODInOiAncicsICc4Myc6ICdzJywgJzg0JzogJ3QnLFxyXG4gICAgICAgICc4NSc6ICd1JywgJzg2JzogJ3YnLCAnODcnOiAndycsICc4OCc6ICd4JyxcclxuICAgICAgICAnODknOiAneScsICc5MCc6ICd6J1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UHJldmlvdXNTZWxlY3RhYmxlKCk6bnVtYmVyIHtcclxuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLnNlbGVjdGVkSW5kZXg7XHJcbiAgICAgICAgd2hpbGUgKC0taW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRlUGFydHNbaW5kZXhdLmlzU2VsZWN0YWJsZSgpKSByZXR1cm4gaW5kZXg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkSW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXROZXh0U2VsZWN0YWJsZSgpOm51bWJlciB7XHJcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5zZWxlY3RlZEluZGV4O1xyXG4gICAgICAgIHdoaWxlICgrK2luZGV4IDwgdGhpcy5kYXRlUGFydHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGVQYXJ0c1tpbmRleF0uaXNTZWxlY3RhYmxlKCkpIHJldHVybiBpbmRleDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRJbmRleDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdGluZzpib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgcHJpdmF0ZSBnZXROZWFyZXN0U2VsZWN0YWJsZUluZGV4KGNhcmV0UG9zaXRpb246bnVtYmVyKTpudW1iZXIge1xyXG4gICAgICAgIGxldCBwb3MgPSAwO1xyXG4gICAgICAgIGxldCBuZWFyZXN0U2VsZWN0YWJsZUluZGV4O1xyXG4gICAgICAgIGxldCBuZWFyZXN0U2VsZWN0YWJsZURpc3RhbmNlO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kYXRlUGFydHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0ZVBhcnRzW2ldLmlzU2VsZWN0YWJsZSgpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZnJvbUxlZnQgPSBjYXJldFBvc2l0aW9uIC0gcG9zO1xyXG4gICAgICAgICAgICAgICAgbGV0IGZyb21SaWdodCA9IGNhcmV0UG9zaXRpb24gLSAocG9zICsgdGhpcy5kYXRlUGFydHNbaV0udG9TdHJpbmcoKS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZyb21MZWZ0ID4gMCAmJiBmcm9tUmlnaHQgPCAwKSByZXR1cm4gaTtcclxuICAgICAgICAgICAgICAgIGxldCBkaXN0ID0gTWF0aC5taW4oTWF0aC5hYnMoZnJvbUxlZnQpLCBNYXRoLmFicyhmcm9tUmlnaHQpKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZWFyZXN0U2VsZWN0YWJsZUluZGV4ID09IHZvaWQgMCB8fCBkaXN0IDw9IG5lYXJlc3RTZWxlY3RhYmxlRGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZWFyZXN0U2VsZWN0YWJsZUluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICBuZWFyZXN0U2VsZWN0YWJsZURpc3RhbmNlID0gZGlzdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwb3MgKz0gdGhpcy5kYXRlUGFydHNbaV0udG9TdHJpbmcoKS5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZWFyZXN0U2VsZWN0YWJsZUluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZm9jdXMoKTp2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy50YWJEb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHRoaXMuZ2V0Rmlyc3RTZWxlY3RhYmxlKCk7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2hpZnRUYWJEb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHRoaXMuZ2V0TGFzdFNlbGVjdGFibGUoKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEZpcnN0U2VsZWN0YWJsZSgpOm51bWJlciB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmRhdGVQYXJ0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRlUGFydHNbaV0uaXNTZWxlY3RhYmxlKCkpIHJldHVybiBpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdm9pZCAwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TGFzdFNlbGVjdGFibGUoKTpudW1iZXIge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmRhdGVQYXJ0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRlUGFydHNbaV0uaXNTZWxlY3RhYmxlKCkpIHJldHVybiBpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdm9pZCAwO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGxhc3RTZWxlY3RlZEluZGV4Om51bWJlcjtcclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlKGRhdGU/OkRhdGUpOnZvaWQge1xyXG4gICAgICAgIGlmIChkYXRlID09PSB2b2lkIDApIGRhdGUgPSB0aGlzLmN1ckRhdGU7XHJcbiAgICAgICAgaWYgKHRoaXMubWluRGF0ZSAhPT0gdm9pZCAwICYmIGRhdGUudmFsdWVPZigpIDwgdGhpcy5taW5EYXRlLnZhbHVlT2YoKSkgZGF0ZSA9IG5ldyBEYXRlKHRoaXMubWluRGF0ZS52YWx1ZU9mKCkpO1xyXG4gICAgICAgIGlmICh0aGlzLm1heERhdGUgIT09IHZvaWQgMCAmJiBkYXRlLnZhbHVlT2YoKSA8IHRoaXMubWF4RGF0ZS52YWx1ZU9mKCkpIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLm1heERhdGUudmFsdWVPZigpKTtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEluZGV4ICE9PSB0aGlzLmxhc3RTZWxlY3RlZEluZGV4KSB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dEJ1ZmZlciA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxhc3RTZWxlY3RlZEluZGV4ID0gdGhpcy5zZWxlY3RlZEluZGV4O1xyXG5cclxuICAgICAgICB0aGlzLmN1ckRhdGUgPSBuZXcgRGF0ZShkYXRlLnZhbHVlT2YoKSk7XHJcbiAgICAgICAgbGV0IGRhdGVTdHJpbmcgPSAnJztcclxuXHJcbiAgICAgICAgdGhpcy5kYXRlUGFydHMuZm9yRWFjaCgoZGF0ZVBhcnQpID0+IHtcclxuICAgICAgICAgICAgZGF0ZVN0cmluZyArPSBkYXRlUGFydC5zZXRWYWx1ZShkYXRlKS50b1N0cmluZygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSBkYXRlU3RyaW5nO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVTZWxlY3Rpb24oKTp2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEluZGV4ID09PSB2b2lkIDAgfHwgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPT0gdGhpcy5lbGVtZW50KSByZXR1cm47XHJcbiAgICAgICAgbGV0IHN0YXJ0ID0gMDtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2VsZWN0ZWRJbmRleDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHN0YXJ0ICs9IHRoaXMuZGF0ZVBhcnRzW2ldLnRvU3RyaW5nKCkubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZW5kID0gc3RhcnQgKyB0aGlzLmRhdGVQYXJ0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLnRvU3RyaW5nKCkubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRTZWxlY3Rpb25SYW5nZShzdGFydCwgZW5kKTtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
