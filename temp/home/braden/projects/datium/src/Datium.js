(function(){
/// <reference path="OptionSanitizer.ts" />
/// <reference path="FormatBlocks.ts" />
/// <reference path="DatePart.ts" />
/// <reference path="DisplayParser.ts" />
window['Datium'] = (function () {
    var options;
    return (function () {
        function class_1(opts) {
            this.updateOptions(opts);
        }
        class_1.prototype.updateOptions = function (opts) {
            options = OptionSanitizer.sanitize(opts);
        };
        return class_1;
    })();
})();
var Selection = (function () {
    function Selection(start, end) {
        this.start = start;
        this.end = end;
    }
    return Selection;
})();
var DatepickerInput = (function () {
    function DatepickerInput(element, displayAs, minDate, maxDate) {
        this.element = element;
        this.minDate = minDate;
        this.maxDate = maxDate;
        this.shiftTabDown = false;
        this.tabDown = false;
        this.pasting = false;
        this.textBuffer = '';
        this.keyMap = {
            '48': '0', '96': '0', '49': '1', '97': '1',
            '50': '2', '98': '2', '51': '3', '99': '3',
            '52': '4', '100': '4', '53': '5', '101': '5',
            '54': '6', '102': '6', '55': '7', '103': '7',
            '56': '8', '104': '8', '57': '9', '105': '9',
            '65': 'a', '66': 'b', '67': 'c', '68': 'd',
            '69': 'e', '70': 'f', '71': 'g', '72': 'h',
            '73': 'i', '74': 'j', '75': 'k', '76': 'l',
            '77': 'm', '78': 'n', '79': 'o', '80': 'p',
            '81': 'q', '82': 'r', '83': 's', '84': 't',
            '85': 'u', '86': 'v', '87': 'w', '88': 'x',
            '89': 'y', '90': 'z'
        };
        this.selecting = false;
        this.dateParts = DisplayParser.parse(displayAs);
        this.dateStringRegExp = this.concatRegExp(this.dateParts);
        this.bindEvents();
        this.element.setAttribute('spellcheck', 'false');
        this.update(new Date());
    }
    DatepickerInput.prototype.concatRegExp = function (dateParts) {
        var regExp = '';
        dateParts.forEach(function (datePart) {
            regExp += datePart.getRegExpString();
        });
        return new RegExp("^" + regExp + "$", 'i');
    };
    DatepickerInput.prototype.bindEvents = function () {
        var _this = this;
        this.element.addEventListener('focus', function () { return _this.focus(); });
        this.element.addEventListener('keydown', function (e) { return _this.keydown(e); });
        this.element.addEventListener('paste', function () { return _this.paste(); });
        document.addEventListener('keydown', function (e) {
            if (e.shiftKey && e.keyCode === 9 /* TAB */) {
                _this.shiftTabDown = true;
            }
            else if (e.keyCode === 9 /* TAB */) {
                _this.tabDown = true;
            }
            setTimeout(function () {
                _this.shiftTabDown = false;
                _this.tabDown = false;
            });
        });
        // Prevent Default
        this.element.addEventListener('dragenter', function (e) { return e.preventDefault(); });
        this.element.addEventListener('dragover', function (e) { return e.preventDefault(); });
        this.element.addEventListener('drop', function (e) { return e.preventDefault(); });
        this.element.addEventListener('cut', function (e) { return e.preventDefault(); });
        var caretStart;
        var down = false;
        var mousedown = function () {
            clearInterval(interval);
            down = true;
            _this.element.setSelectionRange(void 0, void 0);
            setTimeout(function () {
                caretStart = _this.element.selectionStart;
            });
        };
        var mouseup = function () {
            if (!down)
                return;
            down = false;
            var pos = _this.element.selectionStart === caretStart ? _this.element.selectionEnd : _this.element.selectionStart;
            _this.selectedIndex = _this.getNearestSelectableIndex(pos);
            if (_this.element.selectionStart > 0 || _this.element.selectionEnd < _this.element.value.length) {
                _this.update();
            }
        };
        var touchstart = function () {
            _this.element.removeEventListener('mousedown', mousedown);
            document.removeEventListener('mouseup', mouseup);
            document.removeEventListener('touchstart', touchstart);
        };
        this.element.addEventListener('mousedown', mousedown);
        document.addEventListener('mouseup', mouseup);
        document.addEventListener('touchstart', touchstart);
        var lastStart;
        var lastEnd;
        var interval = setInterval(function () {
            if (!_this.pasting &&
                (_this.element.selectionStart !== 0 ||
                    _this.element.selectionEnd !== _this.element.value.length) &&
                (_this.element.selectionStart !== lastStart ||
                    _this.element.selectionEnd !== lastEnd)) {
                _this.selectedIndex = _this.getNearestSelectableIndex(_this.element.selectionStart + (_this.element.selectionEnd - _this.element.selectionStart) / 2);
                _this.update();
            }
            lastStart = _this.element.selectionStart;
            lastEnd = _this.element.selectionEnd;
        });
    };
    DatepickerInput.prototype.paste = function () {
        var _this = this;
        this.pasting = true;
        var originalValue = this.element.value;
        setTimeout(function () {
            if (!_this.dateStringRegExp.test(_this.element.value)) {
                _this.element.value = originalValue;
                _this.pasting = false;
                return;
            }
            var newDate = new Date(_this.curDate.valueOf());
            var strPrefix = '';
            _this.dateParts.forEach(function (datePart) {
                var val = _this.element.value.replace(strPrefix, '').match(datePart.getRegExpString())[0];
                strPrefix += val;
                if (!datePart.isSelectable())
                    return;
                newDate = datePart.getDateFromString(newDate, val);
            });
            _this.update(newDate);
            _this.pasting = false;
        });
    };
    DatepickerInput.prototype.keydown = function (e) {
        if ((e.keyCode === 36 /* HOME */ || e.keyCode === 35 /* END */) && e.shiftKey)
            return;
        if (e.keyCode === 67 /* C */ && e.ctrlKey)
            return;
        if (e.keyCode === 65 /* A */ && e.ctrlKey)
            return;
        if (e.keyCode === 86 /* V */ && e.ctrlKey)
            return;
        if ((e.keyCode === 37 /* LEFT */ || e.keyCode === 39 /* RIGHT */) && e.shiftKey)
            return;
        if (e.keyCode === 36 /* HOME */) {
            this.selectedIndex = this.getFirstSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.keyCode === 35 /* END */) {
            this.selectedIndex = this.getLastSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.keyCode === 37 /* LEFT */) {
            this.selectedIndex = this.getPreviousSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.shiftKey && e.keyCode === 9 /* TAB */) {
            var previousSelectable = this.getPreviousSelectable();
            if (previousSelectable !== this.selectedIndex) {
                this.selectedIndex = previousSelectable;
                this.update();
                e.preventDefault();
            }
        }
        else if (e.keyCode === 39 /* RIGHT */) {
            this.selectedIndex = this.getNextSelectable();
            this.update();
            e.preventDefault();
        }
        else if (e.keyCode === 9 /* TAB */) {
            var nextSelectable = this.getNextSelectable();
            if (nextSelectable !== this.selectedIndex) {
                this.selectedIndex = nextSelectable;
                this.update();
                e.preventDefault();
            }
        }
        else if (e.keyCode === 38 /* UP */) {
            var newDate = this.dateParts[this.selectedIndex].increment(this.curDate);
            this.update(newDate);
            e.preventDefault();
        }
        else if (e.keyCode === 40 /* DOWN */) {
            var newDate = this.dateParts[this.selectedIndex].decrement(this.curDate);
            this.update(newDate);
            e.preventDefault();
        }
        else {
            e.preventDefault();
        }
        var keyPressed = this.keyMap[e.keyCode];
        if (e.keyCode === 8 /* BACKSPACE */) {
            this.backspace();
        }
        else if (keyPressed !== void 0) {
            this.textBuffer += keyPressed;
        }
        else if (!e.shiftKey) {
            this.textBuffer = '';
        }
        if (this.textBuffer.length > 0) {
            var orig = this.curDate.valueOf();
            var result = this.dateParts[this.selectedIndex].getDateFromString(this.curDate, this.textBuffer);
            if (result !== void 0 && this.dateParts[this.selectedIndex].getMaxBufferSize(result) !== void 0 && this.textBuffer.length >= this.dateParts[this.selectedIndex].getMaxBufferSize(result)) {
                this.selectedIndex = this.getNextSelectable();
            }
            if (result === void 0) {
                this.textBuffer = this.textBuffer.slice(0, this.textBuffer.length - 1);
            }
            else {
                this.update(result);
            }
        }
    };
    DatepickerInput.prototype.backspace = function () {
        if (this.textBuffer.length < 2) {
            var orig = this.curDate.valueOf();
            var result = this.dateParts[this.selectedIndex].getDateFromString(this.curDate, 'ZERO_OUT');
            if (result.valueOf() !== orig) {
                this.update(result);
            }
        }
        this.textBuffer = this.textBuffer.slice(0, this.textBuffer.length - 1);
    };
    DatepickerInput.prototype.getPreviousSelectable = function () {
        var index = this.selectedIndex;
        while (--index >= 0) {
            if (this.dateParts[index].isSelectable())
                return index;
        }
        return this.selectedIndex;
    };
    DatepickerInput.prototype.getNextSelectable = function () {
        var index = this.selectedIndex;
        while (++index < this.dateParts.length) {
            if (this.dateParts[index].isSelectable())
                return index;
        }
        return this.selectedIndex;
    };
    DatepickerInput.prototype.getNearestSelectableIndex = function (caretPosition) {
        var pos = 0;
        var nearestSelectableIndex;
        var nearestSelectableDistance;
        for (var i = 0; i < this.dateParts.length; i++) {
            if (this.dateParts[i].isSelectable()) {
                var fromLeft = caretPosition - pos;
                var fromRight = caretPosition - (pos + this.dateParts[i].toString().length);
                if (fromLeft > 0 && fromRight < 0)
                    return i;
                var dist = Math.min(Math.abs(fromLeft), Math.abs(fromRight));
                if (nearestSelectableIndex == void 0 || dist <= nearestSelectableDistance) {
                    nearestSelectableIndex = i;
                    nearestSelectableDistance = dist;
                }
            }
            pos += this.dateParts[i].toString().length;
        }
        return nearestSelectableIndex;
    };
    DatepickerInput.prototype.focus = function () {
        var _this = this;
        if (this.tabDown) {
            this.selectedIndex = this.getFirstSelectable();
            setTimeout(function () {
                _this.update();
            });
        }
        else if (this.shiftTabDown) {
            this.selectedIndex = this.getLastSelectable();
            setTimeout(function () {
                _this.update();
            });
        }
    };
    DatepickerInput.prototype.getFirstSelectable = function () {
        for (var i = 0; i < this.dateParts.length; i++) {
            if (this.dateParts[i].isSelectable())
                return i;
        }
        return void 0;
    };
    DatepickerInput.prototype.getLastSelectable = function () {
        for (var i = this.dateParts.length - 1; i >= 0; i--) {
            if (this.dateParts[i].isSelectable())
                return i;
        }
        return void 0;
    };
    DatepickerInput.prototype.update = function (date) {
        if (date === void 0)
            date = this.curDate;
        if (this.minDate !== void 0 && date.valueOf() < this.minDate.valueOf())
            date = new Date(this.minDate.valueOf());
        if (this.maxDate !== void 0 && date.valueOf() < this.maxDate.valueOf())
            date = new Date(this.maxDate.valueOf());
        if (this.selectedIndex !== this.lastSelectedIndex) {
            this.textBuffer = '';
        }
        this.lastSelectedIndex = this.selectedIndex;
        this.curDate = new Date(date.valueOf());
        var dateString = '';
        this.dateParts.forEach(function (datePart) {
            dateString += datePart.setValue(date).toString();
        });
        this.element.value = dateString;
        this.updateSelection();
    };
    DatepickerInput.prototype.updateSelection = function () {
        if (this.selectedIndex === void 0 || document.activeElement !== this.element)
            return;
        var start = 0;
        for (var i = 0; i < this.selectedIndex; i++) {
            start += this.dateParts[i].toString().length;
        }
        var end = start + this.dateParts[this.selectedIndex].toString().length;
        this.element.setSelectionRange(start, end);
    };
    return DatepickerInput;
})();
exports["default"] = DatepickerInput;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRhdGl1bS50cyJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsInVwZGF0ZU9wdGlvbnMiLCJTZWxlY3Rpb24iLCJTZWxlY3Rpb24uY29uc3RydWN0b3IiLCJEYXRlcGlja2VySW5wdXQiLCJEYXRlcGlja2VySW5wdXQuY29uc3RydWN0b3IiLCJEYXRlcGlja2VySW5wdXQuY29uY2F0UmVnRXhwIiwiRGF0ZXBpY2tlcklucHV0LmJpbmRFdmVudHMiLCJEYXRlcGlja2VySW5wdXQucGFzdGUiLCJEYXRlcGlja2VySW5wdXQua2V5ZG93biIsIkRhdGVwaWNrZXJJbnB1dC5iYWNrc3BhY2UiLCJEYXRlcGlja2VySW5wdXQuZ2V0UHJldmlvdXNTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LmdldE5leHRTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LmdldE5lYXJlc3RTZWxlY3RhYmxlSW5kZXgiLCJEYXRlcGlja2VySW5wdXQuZm9jdXMiLCJEYXRlcGlja2VySW5wdXQuZ2V0Rmlyc3RTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LmdldExhc3RTZWxlY3RhYmxlIiwiRGF0ZXBpY2tlcklucHV0LnVwZGF0ZSIsIkRhdGVwaWNrZXJJbnB1dC51cGRhdGVTZWxlY3Rpb24iXSwibWFwcGluZ3MiOiJBQUFBLDJDQUEyQztBQUMzQyx3Q0FBd0M7QUFDeEMsb0NBQW9DO0FBQ3BDLHlDQUF5QztBQUVuQyxNQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQztJQUN2QixJQUFJLE9BQWdCLENBQUM7SUFFckIsTUFBTSxDQUFDO1FBQ0gsaUJBQVksSUFBYTtZQUNyQkEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLENBQUNBO1FBRUQsK0JBQWEsR0FBYixVQUFjLElBQWE7WUFDdkJDLE9BQU9BLEdBQUdBLGVBQWVBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzdDQSxDQUFDQTtRQUNMLGNBQUM7SUFBRCxDQVJPLEFBUU4sR0FBQSxDQUFBO0FBQ0wsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQVFMO0lBQ0lDLG1CQUFtQkEsS0FBWUEsRUFBU0EsR0FBVUE7UUFBL0JDLFVBQUtBLEdBQUxBLEtBQUtBLENBQU9BO1FBQVNBLFFBQUdBLEdBQUhBLEdBQUdBLENBQU9BO0lBQUdBLENBQUNBO0lBQzFERCxnQkFBQ0E7QUFBREEsQ0FGQSxBQUVDQSxJQUFBO0FBRUQ7SUFPSUUseUJBQW9CQSxPQUF3QkEsRUFBRUEsU0FBZ0JBLEVBQVVBLE9BQWFBLEVBQVVBLE9BQWFBO1FBQXhGQyxZQUFPQSxHQUFQQSxPQUFPQSxDQUFpQkE7UUFBNEJBLFlBQU9BLEdBQVBBLE9BQU9BLENBQU1BO1FBQVVBLFlBQU9BLEdBQVBBLE9BQU9BLENBQU1BO1FBd0ZwR0EsaUJBQVlBLEdBQUdBLEtBQUtBLENBQUNBO1FBQ3JCQSxZQUFPQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUNoQkEsWUFBT0EsR0FBV0EsS0FBS0EsQ0FBQ0E7UUF3QnhCQSxlQUFVQSxHQUFVQSxFQUFFQSxDQUFDQTtRQXNGdkJBLFdBQU1BLEdBQW9CQTtZQUM5QkEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0E7WUFDMUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBO1lBQzFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxLQUFLQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxLQUFLQSxFQUFFQSxHQUFHQTtZQUM1Q0EsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsS0FBS0EsRUFBRUEsR0FBR0E7WUFDNUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLEdBQUdBO1lBQzVDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQTtZQUMxQ0EsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0E7WUFDMUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBO1lBQzFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQTtZQUMxQ0EsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsR0FBR0E7WUFDMUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBO1lBQzFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxHQUFHQTtTQUN2QkEsQ0FBQUE7UUFrQk9BLGNBQVNBLEdBQVdBLEtBQUtBLENBQUNBO1FBdE85QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsYUFBYUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDaERBLElBQUlBLENBQUNBLGdCQUFnQkEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FB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Q0EsQ0FBQ0EsY0FBY0EsRUFBRUEsQ0FBQ0E7UUFDdkJBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ0pBLENBQUNBLENBQUNBLGNBQWNBLEVBQUVBLENBQUNBO1FBQ3ZCQSxDQUFDQTtRQUVEQSxJQUFJQSxVQUFVQSxHQUFRQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUU3Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsS0FBS0EsaUJBQWtCQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNuQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7UUFDckJBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLFVBQVVBLEtBQUtBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQy9CQSxJQUFJQSxDQUFDQSxVQUFVQSxJQUFJQSxVQUFVQSxDQUFDQTtRQUNsQ0EsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDckJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ3pCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDbENBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0E7WUFDakdBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEtBQUtBLEtBQUtBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsS0FBS0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsSUFBSUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDdkxBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0E7WUFDbERBLENBQUNBO1lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEtBQUtBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNwQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0VBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNKQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUN4QkEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFFT0wsbUNBQVNBLEdBQWpCQTtRQUNJTSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDbENBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlB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Q0FBQ0EsYUFBYUEsS0FBS0EsS0FBS0EsQ0FBQ0EsSUFBSUEsUUFBUUEsQ0FBQ0EsYUFBYUEsS0FBS0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7WUFBQ0EsTUFBTUEsQ0FBQ0E7UUFDckZBLElBQUlBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2RBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNqREEsQ0FBQ0E7UUFDREEsSUFBSUEsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDdkVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLGlCQUFpQkEsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDL0NBLENBQUNBO0lBQ0xkLHNCQUFDQTtBQUFEQSxDQWhVQSxBQWdVQ0EsSUFBQTtBQWhVRCxvQ0FnVUMsQ0FBQSIsImZpbGUiOiJob21lL2JyYWRlbi9wcm9qZWN0cy9kYXRpdW0vc3JjL0RhdGl1bS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJPcHRpb25TYW5pdGl6ZXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkZvcm1hdEJsb2Nrcy50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiRGF0ZVBhcnQudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkRpc3BsYXlQYXJzZXIudHNcIiAvPlxuXG4oPGFueT53aW5kb3cpWydEYXRpdW0nXSA9IChmdW5jdGlvbigpIHtcbiAgICBsZXQgb3B0aW9uczpJT3B0aW9ucztcbiAgICBcbiAgICByZXR1cm4gY2xhc3Mge1xuICAgICAgICBjb25zdHJ1Y3RvcihvcHRzOklPcHRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMob3B0cyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHVwZGF0ZU9wdGlvbnMob3B0czpJT3B0aW9ucyk6dm9pZCB7XG4gICAgICAgICAgICBvcHRpb25zID0gT3B0aW9uU2FuaXRpemVyLnNhbml0aXplKG9wdHMpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcblxuZXhwb3J0IGNvbnN0IGVudW0gS2V5Q29kZXMge1xuICAgIFJJR0hUID0gMzksIExFRlQgPSAzNywgVEFCID0gOSwgVVAgPSAzOCxcbiAgICBET1dOID0gNDAsIFYgPSA4NiwgQyA9IDY3LCBBID0gNjUsIEhPTUUgPSAzNixcbiAgICBFTkQgPSAzNSwgQkFDS1NQQUNFID0gOFxufVxuXG5jbGFzcyBTZWxlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBzdGFydDpudW1iZXIsIHB1YmxpYyBlbmQ6bnVtYmVyKSB7fVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEYXRlcGlja2VySW5wdXQge1xuXG4gICAgcHJpdmF0ZSBzZWxlY3RlZEluZGV4Om51bWJlcjtcbiAgICBwcml2YXRlIGN1ckRhdGU6RGF0ZTtcbiAgICBwcml2YXRlIGRhdGVQYXJ0czpEYXRlUGFydFtdO1xuICAgIHByaXZhdGUgZGF0ZVN0cmluZ1JlZ0V4cDpSZWdFeHA7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6SFRNTElucHV0RWxlbWVudCwgZGlzcGxheUFzOnN0cmluZywgcHJpdmF0ZSBtaW5EYXRlPzpEYXRlLCBwcml2YXRlIG1heERhdGU/OkRhdGUpIHtcbiAgICAgICAgdGhpcy5kYXRlUGFydHMgPSBEaXNwbGF5UGFyc2VyLnBhcnNlKGRpc3BsYXlBcyk7XG4gICAgICAgIHRoaXMuZGF0ZVN0cmluZ1JlZ0V4cCA9IHRoaXMuY29uY2F0UmVnRXhwKHRoaXMuZGF0ZVBhcnRzKTtcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKCk7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3NwZWxsY2hlY2snLCAnZmFsc2UnKTtcbiAgICAgICAgdGhpcy51cGRhdGUobmV3IERhdGUoKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb25jYXRSZWdFeHAoZGF0ZVBhcnRzOkRhdGVQYXJ0W10pOlJlZ0V4cCB7XG4gICAgICAgIGxldCByZWdFeHAgPSAnJztcbiAgICAgICAgZGF0ZVBhcnRzLmZvckVhY2goKGRhdGVQYXJ0KSA9PiB7XG4gICAgICAgICAgIHJlZ0V4cCArPSBkYXRlUGFydC5nZXRSZWdFeHBTdHJpbmcoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBuZXcgUmVnRXhwKGBeJHtyZWdFeHB9JGAsICdpJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBiaW5kRXZlbnRzKCk6dm9pZCB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IHRoaXMuZm9jdXMoKSk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gdGhpcy5rZXlkb3duKGUpKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgKCkgPT4gdGhpcy5wYXN0ZSgpKTtcblxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGU6S2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkgJiYgZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5UQUIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNoaWZ0VGFiRG93biA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuVEFCKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50YWJEb3duID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgdGhpcy5zaGlmdFRhYkRvd24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgIHRoaXMudGFiRG93biA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gUHJldmVudCBEZWZhdWx0XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW50ZXInLCAoZSkgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjdXQnLCAoZSkgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcblxuICAgICAgICBsZXQgY2FyZXRTdGFydDpudW1iZXI7XG4gICAgICAgIGxldCBkb3duID0gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBsZXQgbW91c2Vkb3duID0gKCkgPT4ge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgICAgICBkb3duID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXRTZWxlY3Rpb25SYW5nZSh2b2lkIDAsIHZvaWQgMCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjYXJldFN0YXJ0ID0gdGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBsZXQgbW91c2V1cCA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICghZG93bikgcmV0dXJuO1xuICAgICAgICAgICAgZG93biA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IHBvcyA9IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25TdGFydCA9PT0gY2FyZXRTdGFydCA/IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25FbmQgOiB0aGlzLmVsZW1lbnQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldE5lYXJlc3RTZWxlY3RhYmxlSW5kZXgocG9zKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuc2VsZWN0aW9uU3RhcnQgPiAwIHx8IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25FbmQgPCB0aGlzLmVsZW1lbnQudmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGxldCB0b3VjaHN0YXJ0ID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG1vdXNlZG93bik7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgbW91c2V1cCk7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdG91Y2hzdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBtb3VzZWRvd24pO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgbW91c2V1cCk7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0b3VjaHN0YXJ0KTtcblxuICAgICAgICBsZXQgbGFzdFN0YXJ0Om51bWJlcjtcbiAgICAgICAgbGV0IGxhc3RFbmQ6bnVtYmVyO1xuICAgICAgICBsZXQgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMucGFzdGluZyAmJlxuICAgICAgICAgICAgICAgICh0aGlzLmVsZW1lbnQuc2VsZWN0aW9uU3RhcnQgIT09IDAgfHxcbiAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNlbGVjdGlvbkVuZCAhPT0gdGhpcy5lbGVtZW50LnZhbHVlLmxlbmd0aCkgJiZcbiAgICAgICAgICAgICAgICAodGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0ICE9PSBsYXN0U3RhcnQgfHxcbiAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNlbGVjdGlvbkVuZCAhPT0gbGFzdEVuZCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldE5lYXJlc3RTZWxlY3RhYmxlSW5kZXgodGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0ICsgKHRoaXMuZWxlbWVudC5zZWxlY3Rpb25FbmQgLSB0aGlzLmVsZW1lbnQuc2VsZWN0aW9uU3RhcnQpIC8gMik7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdFN0YXJ0ID0gdGhpcy5lbGVtZW50LnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgbGFzdEVuZCA9IHRoaXMuZWxlbWVudC5zZWxlY3Rpb25FbmQ7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHNoaWZ0VGFiRG93biA9IGZhbHNlO1xuICAgIHByaXZhdGUgdGFiRG93biA9IGZhbHNlO1xuICAgIHByaXZhdGUgcGFzdGluZzpib29sZWFuID0gZmFsc2U7XG4gICAgXG4gICAgcHJpdmF0ZSBwYXN0ZSgpOnZvaWQge1xuICAgICAgICB0aGlzLnBhc3RpbmcgPSB0cnVlO1xuICAgICAgICBsZXQgb3JpZ2luYWxWYWx1ZSA9IHRoaXMuZWxlbWVudC52YWx1ZTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuZGF0ZVN0cmluZ1JlZ0V4cC50ZXN0KHRoaXMuZWxlbWVudC52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSBvcmlnaW5hbFZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMucGFzdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBuZXdEYXRlID0gbmV3IERhdGUodGhpcy5jdXJEYXRlLnZhbHVlT2YoKSk7XG4gICAgICAgICAgICBsZXQgc3RyUHJlZml4ID0gJyc7XG4gICAgICAgICAgICB0aGlzLmRhdGVQYXJ0cy5mb3JFYWNoKChkYXRlUGFydCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB2YWwgPSB0aGlzLmVsZW1lbnQudmFsdWUucmVwbGFjZShzdHJQcmVmaXgsICcnKS5tYXRjaChkYXRlUGFydC5nZXRSZWdFeHBTdHJpbmcoKSlbMF07XG4gICAgICAgICAgICAgICAgc3RyUHJlZml4ICs9IHZhbDtcbiAgICAgICAgICAgICAgICBpZiAoIWRhdGVQYXJ0LmlzU2VsZWN0YWJsZSgpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgbmV3RGF0ZSA9IGRhdGVQYXJ0LmdldERhdGVGcm9tU3RyaW5nKG5ld0RhdGUsIHZhbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKG5ld0RhdGUpO1xuICAgICAgICAgICAgdGhpcy5wYXN0aW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgdGV4dEJ1ZmZlcjpzdHJpbmcgPSAnJztcblxuICAgIHByaXZhdGUga2V5ZG93bihlOktleWJvYXJkRXZlbnQpOnZvaWQge1xuICAgICAgICBpZiAoKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuSE9NRSB8fCBlLmtleUNvZGUgPT09IEtleUNvZGVzLkVORCkgJiYgZS5zaGlmdEtleSkgcmV0dXJuO1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5DICYmIGUuY3RybEtleSkgcmV0dXJuO1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5BICYmIGUuY3RybEtleSkgcmV0dXJuO1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5WICYmIGUuY3RybEtleSkgcmV0dXJuO1xuICAgICAgICBpZiAoKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuTEVGVCB8fCBlLmtleUNvZGUgPT09IEtleUNvZGVzLlJJR0hUKSAmJiBlLnNoaWZ0S2V5KSByZXR1cm47XG5cbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuSE9NRSkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gdGhpcy5nZXRGaXJzdFNlbGVjdGFibGUoKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5FTkQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHRoaXMuZ2V0TGFzdFNlbGVjdGFibGUoKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5MRUZUKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldFByZXZpb3VzU2VsZWN0YWJsZSgpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChlLnNoaWZ0S2V5ICYmIGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuVEFCKSB7XG4gICAgICAgICAgICBsZXQgcHJldmlvdXNTZWxlY3RhYmxlID0gdGhpcy5nZXRQcmV2aW91c1NlbGVjdGFibGUoKTtcbiAgICAgICAgICAgIGlmIChwcmV2aW91c1NlbGVjdGFibGUgIT09IHRoaXMuc2VsZWN0ZWRJbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHByZXZpb3VzU2VsZWN0YWJsZTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGVzLlJJR0hUKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldE5leHRTZWxlY3RhYmxlKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuVEFCKSB7XG4gICAgICAgICAgICBsZXQgbmV4dFNlbGVjdGFibGUgPSB0aGlzLmdldE5leHRTZWxlY3RhYmxlKCk7XG4gICAgICAgICAgICBpZiAobmV4dFNlbGVjdGFibGUgIT09IHRoaXMuc2VsZWN0ZWRJbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IG5leHRTZWxlY3RhYmxlO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuVVApIHtcbiAgICAgICAgICAgIGxldCBuZXdEYXRlID0gdGhpcy5kYXRlUGFydHNbdGhpcy5zZWxlY3RlZEluZGV4XS5pbmNyZW1lbnQodGhpcy5jdXJEYXRlKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKG5ld0RhdGUpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZXMuRE9XTikge1xuICAgICAgICAgICAgbGV0IG5ld0RhdGUgPSB0aGlzLmRhdGVQYXJ0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmRlY3JlbWVudCh0aGlzLmN1ckRhdGUpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUobmV3RGF0ZSk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQga2V5UHJlc3NlZCA9IDxhbnk+dGhpcy5rZXlNYXBbZS5rZXlDb2RlXTtcblxuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2Rlcy5CQUNLU1BBQ0UpIHtcbiAgICAgICAgICAgIHRoaXMuYmFja3NwYWNlKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5UHJlc3NlZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRCdWZmZXIgKz0ga2V5UHJlc3NlZDtcbiAgICAgICAgfSBlbHNlIGlmICghZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0QnVmZmVyID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy50ZXh0QnVmZmVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxldCBvcmlnID0gdGhpcy5jdXJEYXRlLnZhbHVlT2YoKTtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0aGlzLmRhdGVQYXJ0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmdldERhdGVGcm9tU3RyaW5nKHRoaXMuY3VyRGF0ZSwgdGhpcy50ZXh0QnVmZmVyKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IHZvaWQgMCAmJiB0aGlzLmRhdGVQYXJ0c1t0aGlzLnNlbGVjdGVkSW5kZXhdLmdldE1heEJ1ZmZlclNpemUocmVzdWx0KSAhPT0gdm9pZCAwICYmIHRoaXMudGV4dEJ1ZmZlci5sZW5ndGggPj0gdGhpcy5kYXRlUGFydHNbdGhpcy5zZWxlY3RlZEluZGV4XS5nZXRNYXhCdWZmZXJTaXplKHJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLmdldE5leHRTZWxlY3RhYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRCdWZmZXIgPSB0aGlzLnRleHRCdWZmZXIuc2xpY2UoMCwgdGhpcy50ZXh0QnVmZmVyLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZShyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBiYWNrc3BhY2UoKTp2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMudGV4dEJ1ZmZlci5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICBsZXQgb3JpZyA9IHRoaXMuY3VyRGF0ZS52YWx1ZU9mKCk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5kYXRlUGFydHNbdGhpcy5zZWxlY3RlZEluZGV4XS5nZXREYXRlRnJvbVN0cmluZyh0aGlzLmN1ckRhdGUsICdaRVJPX09VVCcpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZU9mKCkgIT09IG9yaWcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZShyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGV4dEJ1ZmZlciA9IHRoaXMudGV4dEJ1ZmZlci5zbGljZSgwLCB0aGlzLnRleHRCdWZmZXIubGVuZ3RoIC0gMSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBrZXlNYXA6e30gPSA8W2tleTpzdHJpbmddPntcbiAgICAgICAgJzQ4JzogJzAnLCAnOTYnOiAnMCcsICc0OSc6ICcxJywgJzk3JzogJzEnLFxuICAgICAgICAnNTAnOiAnMicsICc5OCc6ICcyJywgJzUxJzogJzMnLCAnOTknOiAnMycsXG4gICAgICAgICc1Mic6ICc0JywgJzEwMCc6ICc0JywgJzUzJzogJzUnLCAnMTAxJzogJzUnLFxuICAgICAgICAnNTQnOiAnNicsICcxMDInOiAnNicsICc1NSc6ICc3JywgJzEwMyc6ICc3JyxcbiAgICAgICAgJzU2JzogJzgnLCAnMTA0JzogJzgnLCAnNTcnOiAnOScsICcxMDUnOiAnOScsXG4gICAgICAgICc2NSc6ICdhJywgJzY2JzogJ2InLCAnNjcnOiAnYycsICc2OCc6ICdkJyxcbiAgICAgICAgJzY5JzogJ2UnLCAnNzAnOiAnZicsICc3MSc6ICdnJywgJzcyJzogJ2gnLFxuICAgICAgICAnNzMnOiAnaScsICc3NCc6ICdqJywgJzc1JzogJ2snLCAnNzYnOiAnbCcsXG4gICAgICAgICc3Nyc6ICdtJywgJzc4JzogJ24nLCAnNzknOiAnbycsICc4MCc6ICdwJyxcbiAgICAgICAgJzgxJzogJ3EnLCAnODInOiAncicsICc4Myc6ICdzJywgJzg0JzogJ3QnLFxuICAgICAgICAnODUnOiAndScsICc4Nic6ICd2JywgJzg3JzogJ3cnLCAnODgnOiAneCcsXG4gICAgICAgICc4OSc6ICd5JywgJzkwJzogJ3onXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQcmV2aW91c1NlbGVjdGFibGUoKTpudW1iZXIge1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLnNlbGVjdGVkSW5kZXg7XG4gICAgICAgIHdoaWxlICgtLWluZGV4ID49IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGVQYXJ0c1tpbmRleF0uaXNTZWxlY3RhYmxlKCkpIHJldHVybiBpbmRleDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZEluZGV4O1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TmV4dFNlbGVjdGFibGUoKTpudW1iZXIge1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLnNlbGVjdGVkSW5kZXg7XG4gICAgICAgIHdoaWxlICgrK2luZGV4IDwgdGhpcy5kYXRlUGFydHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kYXRlUGFydHNbaW5kZXhdLmlzU2VsZWN0YWJsZSgpKSByZXR1cm4gaW5kZXg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRJbmRleDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNlbGVjdGluZzpib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIGdldE5lYXJlc3RTZWxlY3RhYmxlSW5kZXgoY2FyZXRQb3NpdGlvbjpudW1iZXIpOm51bWJlciB7XG4gICAgICAgIGxldCBwb3MgPSAwO1xuICAgICAgICBsZXQgbmVhcmVzdFNlbGVjdGFibGVJbmRleDtcbiAgICAgICAgbGV0IG5lYXJlc3RTZWxlY3RhYmxlRGlzdGFuY2U7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kYXRlUGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGVQYXJ0c1tpXS5pc1NlbGVjdGFibGUoKSkge1xuICAgICAgICAgICAgICAgIGxldCBmcm9tTGVmdCA9IGNhcmV0UG9zaXRpb24gLSBwb3M7XG4gICAgICAgICAgICAgICAgbGV0IGZyb21SaWdodCA9IGNhcmV0UG9zaXRpb24gLSAocG9zICsgdGhpcy5kYXRlUGFydHNbaV0udG9TdHJpbmcoKS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGlmIChmcm9tTGVmdCA+IDAgJiYgZnJvbVJpZ2h0IDwgMCkgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgbGV0IGRpc3QgPSBNYXRoLm1pbihNYXRoLmFicyhmcm9tTGVmdCksIE1hdGguYWJzKGZyb21SaWdodCkpO1xuICAgICAgICAgICAgICAgIGlmIChuZWFyZXN0U2VsZWN0YWJsZUluZGV4ID09IHZvaWQgMCB8fCBkaXN0IDw9IG5lYXJlc3RTZWxlY3RhYmxlRGlzdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgbmVhcmVzdFNlbGVjdGFibGVJbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIG5lYXJlc3RTZWxlY3RhYmxlRGlzdGFuY2UgPSBkaXN0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBvcyArPSB0aGlzLmRhdGVQYXJ0c1tpXS50b1N0cmluZygpLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmVhcmVzdFNlbGVjdGFibGVJbmRleDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZvY3VzKCk6dm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnRhYkRvd24pIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IHRoaXMuZ2V0Rmlyc3RTZWxlY3RhYmxlKCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNoaWZ0VGFiRG93bikge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gdGhpcy5nZXRMYXN0U2VsZWN0YWJsZSgpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEZpcnN0U2VsZWN0YWJsZSgpOm51bWJlciB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kYXRlUGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGVQYXJ0c1tpXS5pc1NlbGVjdGFibGUoKSkgcmV0dXJuIGk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldExhc3RTZWxlY3RhYmxlKCk6bnVtYmVyIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuZGF0ZVBhcnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kYXRlUGFydHNbaV0uaXNTZWxlY3RhYmxlKCkpIHJldHVybiBpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfVxuXG5cbiAgICBwcml2YXRlIGxhc3RTZWxlY3RlZEluZGV4Om51bWJlcjtcblxuICAgIHB1YmxpYyB1cGRhdGUoZGF0ZT86RGF0ZSk6dm9pZCB7XG4gICAgICAgIGlmIChkYXRlID09PSB2b2lkIDApIGRhdGUgPSB0aGlzLmN1ckRhdGU7XG4gICAgICAgIGlmICh0aGlzLm1pbkRhdGUgIT09IHZvaWQgMCAmJiBkYXRlLnZhbHVlT2YoKSA8IHRoaXMubWluRGF0ZS52YWx1ZU9mKCkpIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLm1pbkRhdGUudmFsdWVPZigpKTtcbiAgICAgICAgaWYgKHRoaXMubWF4RGF0ZSAhPT0gdm9pZCAwICYmIGRhdGUudmFsdWVPZigpIDwgdGhpcy5tYXhEYXRlLnZhbHVlT2YoKSkgZGF0ZSA9IG5ldyBEYXRlKHRoaXMubWF4RGF0ZS52YWx1ZU9mKCkpO1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEluZGV4ICE9PSB0aGlzLmxhc3RTZWxlY3RlZEluZGV4KSB7XG4gICAgICAgICAgICB0aGlzLnRleHRCdWZmZXIgPSAnJztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhc3RTZWxlY3RlZEluZGV4ID0gdGhpcy5zZWxlY3RlZEluZGV4O1xuXG4gICAgICAgIHRoaXMuY3VyRGF0ZSA9IG5ldyBEYXRlKGRhdGUudmFsdWVPZigpKTtcbiAgICAgICAgbGV0IGRhdGVTdHJpbmcgPSAnJztcblxuICAgICAgICB0aGlzLmRhdGVQYXJ0cy5mb3JFYWNoKChkYXRlUGFydCkgPT4ge1xuICAgICAgICAgICAgZGF0ZVN0cmluZyArPSBkYXRlUGFydC5zZXRWYWx1ZShkYXRlKS50b1N0cmluZygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSBkYXRlU3RyaW5nO1xuICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGlvbigpO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlU2VsZWN0aW9uKCk6dm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSW5kZXggPT09IHZvaWQgMCB8fCBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICE9PSB0aGlzLmVsZW1lbnQpIHJldHVybjtcbiAgICAgICAgbGV0IHN0YXJ0ID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdGVkSW5kZXg7IGkrKykge1xuICAgICAgICAgICAgc3RhcnQgKz0gdGhpcy5kYXRlUGFydHNbaV0udG9TdHJpbmcoKS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGVuZCA9IHN0YXJ0ICsgdGhpcy5kYXRlUGFydHNbdGhpcy5zZWxlY3RlZEluZGV4XS50b1N0cmluZygpLmxlbmd0aDtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldFNlbGVjdGlvblJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIH1cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
