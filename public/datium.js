(function(){
window['Datium'] = (function () {
    function Datium(options) {
        var internals = new DatiumInternals(options);
        this.update = internals.update;
    }
    return Datium;
})();
var DatiumInternals = (function () {
    function DatiumInternals(options) {
        var _this = this;
        this.input = new Input();
        this.update = function (options) {
            _this.options = OptionSanitizer.sanitize(options);
            _this.input.update(_this.options);
        };
        this.update(options);
    }
    return DatiumInternals;
})();
var OptionSanitizer = (function () {
    function OptionSanitizer() {
    }
    OptionSanitizer.sanitizeElement = function (element) {
        if (element === void 0)
            throw 'Element must be defined';
        return element;
    };
    OptionSanitizer.sanitizeDisplayAs = function (displayAs) {
        if (displayAs === void 0)
            return 'YYYY mmm ddd';
        if (typeof displayAs !== 'string')
            throw 'Display as must be a string';
        return displayAs;
    };
    OptionSanitizer.sanitize = function (options) {
        return {
            element: OptionSanitizer.sanitizeElement(options['element']),
            displayAs: OptionSanitizer.sanitizeDisplayAs(options['displayAs'])
        };
    };
    return OptionSanitizer;
})();
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var PlainText = (function () {
    function PlainText(text) {
        var _this = this;
        this.text = text;
        this.increment = function () { return null; };
        this.decrement = function () { return null; };
        this.setValue = function (value) { return null; };
        this.getRegEx = function () { return null; };
        this.toString = function () { return _this.text; };
    }
    return PlainText;
})();
var formatBlocks = (function () {
    var formatBlocks = {};
    var DatePart = (function () {
        function DatePart() {
            var _this = this;
            this.increment = function () {
                if (_this.date === void 0)
                    return void 0;
            };
        }
        return DatePart;
    })();
    formatBlocks['YYYY'] = (function (_super) {
        __extends(class_1, _super);
        function class_1() {
            var _this = this;
            _super.apply(this, arguments);
            this.increment = function () {
                return _super.prototype.increment.call(_this);
            };
            this.decrement = function () {
                return null;
            };
            this.setValue = function (value) {
                return null;
            };
            this.getRegEx = function () { return '\\d{4,4}'; };
            this.toString = function () {
                if (_this.date === void 0)
                    return '----';
                return _this.date.getFullYear().toString();
            };
        }
        return class_1;
    })(DatePart);
    return formatBlocks;
})();
var Input = (function () {
    function Input() {
    }
    Input.prototype.update = function (options) {
        this.options = options;
        this.dateParts = Parser.parse(options.displayAs);
        var dateString = '';
        console.log(options.displayAs);
        this.dateParts.forEach(function (datePart) {
            dateString += datePart.toString();
        });
        console.log(dateString);
    };
    return Input;
})();
var Parser = (function () {
    function Parser() {
    }
    Parser.parse = function (format) {
        var textBuffer = '';
        var dateParts = [];
        var index = 0;
        var inEscapedSegment = false;
        var pushPlainText = function () {
            if (textBuffer.length > 0) {
                dateParts.push(new PlainText(textBuffer));
                textBuffer = '';
            }
        };
        while (index < format.length) {
            if (!inEscapedSegment && format[index] === '[') {
                inEscapedSegment = true;
                index++;
                continue;
            }
            if (inEscapedSegment && format[index] === ']') {
                inEscapedSegment = false;
                index++;
                continue;
            }
            if (inEscapedSegment) {
                textBuffer += format[index];
                index++;
                continue;
            }
            var found = false;
            for (var code in formatBlocks) {
                if (Parser.findAt(format, index, "{" + code + "}")) {
                    pushPlainText();
                    dateParts.push(new formatBlocks[code]());
                    index += code.length + 2;
                    found = true;
                    break;
                }
                else if (Parser.findAt(format, index, code)) {
                    pushPlainText();
                    dateParts.push(new formatBlocks[code]());
                    index += code.length;
                    found = true;
                    break;
                }
            }
            if (!found) {
                textBuffer += format[index];
                index++;
            }
        }
        pushPlainText();
        return dateParts;
    };
    Parser.findAt = function (str, index, search) {
        return str.slice(index, index + search.length) === search;
    };
    return Parser;
})();
var Picker = (function () {
    function Picker() {
    }
    Picker.prototype.update = function (options) {
    };
    return Picker;
})();
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRhdGl1bS50cyIsIkRhdGl1bUludGVybmFscy50cyIsIk9wdGlvblNhbml0aXplci50cyIsImlucHV0L0RhdGVQYXJ0LnRzIiwiaW5wdXQvSW5wdXQudHMiLCJpbnB1dC9QYXJzZXIudHMiLCJwaWNrZXIvUGlja2VyLnRzIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwiRGF0aXVtSW50ZXJuYWxzIiwiRGF0aXVtSW50ZXJuYWxzLmNvbnN0cnVjdG9yIiwiT3B0aW9uU2FuaXRpemVyIiwiT3B0aW9uU2FuaXRpemVyLmNvbnN0cnVjdG9yIiwiUGxhaW5UZXh0IiwiUGxhaW5UZXh0LmNvbnN0cnVjdG9yIiwiRGF0ZVBhcnQiLCJEYXRlUGFydC5jb25zdHJ1Y3RvciIsIklucHV0IiwiSW5wdXQuY29uc3RydWN0b3IiLCJJbnB1dC51cGRhdGUiLCJQYXJzZXIiLCJQYXJzZXIuY29uc3RydWN0b3IiLCJQaWNrZXIiLCJQaWNrZXIuY29uc3RydWN0b3IiLCJQaWNrZXIudXBkYXRlIl0sIm1hcHBpbmdzIjoiQUFBTSxNQUFPLENBQUMsUUFBUSxDQUFDLEdBQUc7SUFFdEIsZ0JBQVksT0FBZ0I7UUFDeEJBLElBQUlBLFNBQVNBLEdBQUdBLElBQUlBLGVBQWVBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQzdDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNuQ0EsQ0FBQ0E7SUFDTCxhQUFDO0FBQUQsQ0FOMEIsQUFNekIsR0FBQSxDQUFBO0FDTkQ7SUFLSUMseUJBQVlBLE9BQWdCQTtRQUxoQ0MsaUJBZUNBO1FBWldBLFVBQUtBLEdBQVNBLElBQUlBLEtBQUtBLEVBQUVBLENBQUNBO1FBTTNCQSxXQUFNQSxHQUFHQSxVQUFDQSxPQUFnQkE7WUFDN0JBLEtBQUlBLENBQUNBLE9BQU9BLEdBQUdBLGVBQWVBLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1lBRWpEQSxLQUFJQSxDQUFDQSxLQUFLQSxD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QSxDQUFDQTtvQkFDckJBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO29CQUNiQSxLQUFLQSxDQUFDQTtnQkFDVkEsQ0FBQ0E7WUFDTEEsQ0FBQ0E7WUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1RBLFVBQVVBLElBQUlBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO2dCQUM1QkEsS0FBS0EsRUFBRUEsQ0FBQ0E7WUFDWkEsQ0FBQ0E7UUFFTEEsQ0FBQ0E7UUFFREEsYUFBYUEsRUFBRUEsQ0FBQ0E7UUFFaEJBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBO0lBQ3JCQSxDQUFDQSxDQUFBQTtJQUVjQSxhQUFNQSxHQUFHQSxVQUFDQSxHQUFVQSxFQUFFQSxLQUFZQSxFQUFFQSxNQUFhQTtRQUM1REEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsRUFBRUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsTUFBTUEsQ0FBQ0E7SUFDOURBLENBQUNBLENBQUFBO0lBQ0xBLGFBQUNBO0FBQURBLENBcEVBLEFBb0VDQSxJQUFBO0FDcEVEO0lBQ0lFO0lBRUFDLENBQUNBO0lBRU1ELHVCQUFNQSxHQUFiQSxVQUFjQSxPQUFnQkE7SUFFOUJFLENBQUNBO0lBQ0xGLGFBQUNBO0FBQURBLENBUkEsQUFRQ0EsSUFBQSIsImZpbGUiOiJkYXRpdW0uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoPGFueT53aW5kb3cpWydEYXRpdW0nXSA9IGNsYXNzIERhdGl1bSB7XHJcbiAgICBwdWJsaWMgdXBkYXRlOihvcHRpb25zOklPcHRpb25zKSA9PiB2b2lkO1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczpJT3B0aW9ucykge1xyXG4gICAgICAgIGxldCBpbnRlcm5hbHMgPSBuZXcgRGF0aXVtSW50ZXJuYWxzKG9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlID0gaW50ZXJuYWxzLnVwZGF0ZTtcclxuICAgIH1cclxufSIsImNsYXNzIERhdGl1bUludGVybmFscyB7XHJcbiAgICBwcml2YXRlIG9wdGlvbnM6SU9wdGlvbnM7XHJcbiAgICBcclxuICAgIHByaXZhdGUgaW5wdXQ6SW5wdXQgPSBuZXcgSW5wdXQoKTtcclxuICAgIFxyXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczpJT3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMudXBkYXRlKG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgdXBkYXRlID0gKG9wdGlvbnM6SU9wdGlvbnMpID0+IHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPcHRpb25TYW5pdGl6ZXIuc2FuaXRpemUob3B0aW9ucyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5pbnB1dC51cGRhdGUodGhpcy5vcHRpb25zKTtcclxuICAgICAgICBcclxuICAgIH1cclxufSIsImNsYXNzIE9wdGlvblNhbml0aXplciB7XHJcbiAgICBzdGF0aWMgc2FuaXRpemVFbGVtZW50ID0gKGVsZW1lbnQ6SFRNTElucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgIGlmIChlbGVtZW50ID09PSB2b2lkIDApIHRocm93ICdFbGVtZW50IG11c3QgYmUgZGVmaW5lZCc7XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBzdGF0aWMgc2FuaXRpemVEaXNwbGF5QXMgPSAoZGlzcGxheUFzOnN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmIChkaXNwbGF5QXMgPT09IHZvaWQgMCkgcmV0dXJuICdZWVlZIG1tbSBkZGQnO1xyXG4gICAgICAgIGlmICh0eXBlb2YgZGlzcGxheUFzICE9PSAnc3RyaW5nJykgdGhyb3cgJ0Rpc3BsYXkgYXMgbXVzdCBiZSBhIHN0cmluZyc7XHJcbiAgICAgICAgcmV0dXJuIGRpc3BsYXlBcztcclxuICAgIH1cclxuICAgIFxyXG4gICAgc3RhdGljIHNhbml0aXplID0gKG9wdGlvbnM6SU9wdGlvbnMpID0+IHtcclxuICAgICAgICByZXR1cm4gPElPcHRpb25zPntcclxuICAgICAgICAgICAgZWxlbWVudDogT3B0aW9uU2FuaXRpemVyLnNhbml0aXplRWxlbWVudChvcHRpb25zWydlbGVtZW50J10pLFxyXG4gICAgICAgICAgICBkaXNwbGF5QXM6IE9wdGlvblNhbml0aXplci5zYW5pdGl6ZURpc3BsYXlBcyhvcHRpb25zWydkaXNwbGF5QXMnXSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJpbnRlcmZhY2UgSURhdGVQYXJ0IHtcclxuICAgIGluY3JlbWVudCgpOkRhdGU7XHJcbiAgICBkZWNyZW1lbnQoKTpEYXRlO1xyXG4gICAgc2V0VmFsdWUodmFsdWU6RGF0ZXxudW1iZXJ8c3RyaW5nKTpEYXRlO1xyXG4gICAgZ2V0UmVnRXgoKTpzdHJpbmc7XHJcbiAgICB0b1N0cmluZygpOnN0cmluZztcclxufVxyXG5cclxuY2xhc3MgUGxhaW5UZXh0IGltcGxlbWVudHMgSURhdGVQYXJ0IHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdGV4dDpzdHJpbmcpIHt9XHJcbiAgICBwdWJsaWMgaW5jcmVtZW50ID0gKCk6RGF0ZSA9PiBudWxsO1xyXG4gICAgcHVibGljIGRlY3JlbWVudCA9ICgpOkRhdGUgPT4gbnVsbDtcclxuICAgIHB1YmxpYyBzZXRWYWx1ZSA9ICh2YWx1ZTpEYXRlfG51bWJlcnxzdHJpbmcpOkRhdGUgPT4gbnVsbDtcclxuICAgIHB1YmxpYyBnZXRSZWdFeCA9ICgpOnN0cmluZyA9PiBudWxsO1xyXG4gICAgcHVibGljIHRvU3RyaW5nID0gKCk6c3RyaW5nID0+IHRoaXMudGV4dDtcclxufVxyXG5cclxubGV0IGZvcm1hdEJsb2NrcyA9IChmdW5jdGlvbigpIHtcclxuICAgIGxldCBmb3JtYXRCbG9ja3M6eyBba2V5OnN0cmluZ106IG5ldyAoKSA9PiBJRGF0ZVBhcnQ7IH0gPSB7fTtcclxuICAgIFxyXG4gICAgY2xhc3MgRGF0ZVBhcnQge1xyXG4gICAgICAgIHByb3RlY3RlZCBkYXRlOkRhdGU7XHJcbiAgICAgICAgcHJvdGVjdGVkIGluY3JlbWVudCA9ICgpOkRhdGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRlID09PSB2b2lkIDApIHJldHVybiB2b2lkIDA7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZm9ybWF0QmxvY2tzWydZWVlZJ10gPSBjbGFzcyBleHRlbmRzIERhdGVQYXJ0IGltcGxlbWVudHMgSURhdGVQYXJ0IHtcclxuICAgICAgICBwdWJsaWMgaW5jcmVtZW50ID0gKCk6RGF0ZSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5pbmNyZW1lbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcHVibGljIGRlY3JlbWVudCA9ICgpOkRhdGUgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcHVibGljIHNldFZhbHVlID0gKHZhbHVlOkRhdGV8bnVtYmVyfHN0cmluZyk6RGF0ZSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBwdWJsaWMgZ2V0UmVnRXggPSAoKTpzdHJpbmcgPT4gJ1xcXFxkezQsNH0nO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHB1YmxpYyB0b1N0cmluZyA9ICgpOnN0cmluZyA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGUgPT09IHZvaWQgMCkgcmV0dXJuICctLS0tJztcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZm9ybWF0QmxvY2tzO1xyXG59KSgpO1xyXG5cclxuXHJcblxyXG5cclxuIiwiY2xhc3MgSW5wdXQge1xyXG4gICAgcHJpdmF0ZSBvcHRpb25zOklPcHRpb25zO1xyXG4gICAgcHJpdmF0ZSBkYXRlUGFydHM6SURhdGVQYXJ0W107XHJcbiAgICBcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgdXBkYXRlKG9wdGlvbnM6SU9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZGF0ZVBhcnRzID0gUGFyc2VyLnBhcnNlKG9wdGlvbnMuZGlzcGxheUFzKTtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgZGF0ZVN0cmluZyA9ICcnO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKG9wdGlvbnMuZGlzcGxheUFzKTtcclxuICAgICAgICB0aGlzLmRhdGVQYXJ0cy5mb3JFYWNoKChkYXRlUGFydCkgPT4ge1xyXG4gICAgICAgICAgICBkYXRlU3RyaW5nICs9IGRhdGVQYXJ0LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coZGF0ZVN0cmluZyk7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBQYXJzZXIge1xyXG4gICAgXHJcbiAgICBwdWJsaWMgc3RhdGljIHBhcnNlID0gKGZvcm1hdDpzdHJpbmcpOklEYXRlUGFydFtdID0+IHtcclxuICAgICAgICBsZXQgdGV4dEJ1ZmZlciA9ICcnO1xyXG4gICAgICAgIGxldCBkYXRlUGFydHM6SURhdGVQYXJ0W10gPSBbXTtcclxuICAgIFxyXG4gICAgICAgIGxldCBpbmRleCA9IDA7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIGxldCBpbkVzY2FwZWRTZWdtZW50ID0gZmFsc2U7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IHB1c2hQbGFpblRleHQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0ZXh0QnVmZmVyLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGRhdGVQYXJ0cy5wdXNoKG5ldyBQbGFpblRleHQodGV4dEJ1ZmZlcikpO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJ1ZmZlciA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHdoaWxlIChpbmRleCA8IGZvcm1hdC5sZW5ndGgpIHsgICAgIFxyXG4gICAgICAgICAgICBpZiAoIWluRXNjYXBlZFNlZ21lbnQgJiYgZm9ybWF0W2luZGV4XSA9PT0gJ1snKSB7XHJcbiAgICAgICAgICAgICAgICBpbkVzY2FwZWRTZWdtZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGluRXNjYXBlZFNlZ21lbnQgJiYgZm9ybWF0W2luZGV4XSA9PT0gJ10nKSB7XHJcbiAgICAgICAgICAgICAgICBpbkVzY2FwZWRTZWdtZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChpbkVzY2FwZWRTZWdtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0QnVmZmVyICs9IGZvcm1hdFtpbmRleF07XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9yIChsZXQgY29kZSBpbiBmb3JtYXRCbG9ja3MpIHtcclxuICAgICAgICAgICAgICAgIGlmIChQYXJzZXIuZmluZEF0KGZvcm1hdCwgaW5kZXgsIGB7JHtjb2RlfX1gKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHB1c2hQbGFpblRleHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRlUGFydHMucHVzaChuZXcgZm9ybWF0QmxvY2tzW2NvZGVdKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ICs9IGNvZGUubGVuZ3RoICsgMjtcclxuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBhcnNlci5maW5kQXQoZm9ybWF0LCBpbmRleCwgY29kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBwdXNoUGxhaW5UZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZVBhcnRzLnB1c2gobmV3IGZvcm1hdEJsb2Nrc1tjb2RlXSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCArPSBjb2RlLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICghZm91bmQpIHtcclxuICAgICAgICAgICAgICAgIHRleHRCdWZmZXIgKz0gZm9ybWF0W2luZGV4XTtcclxuICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHB1c2hQbGFpblRleHQoKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIHJldHVybiBkYXRlUGFydHM7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHByaXZhdGUgc3RhdGljIGZpbmRBdCA9IChzdHI6c3RyaW5nLCBpbmRleDpudW1iZXIsIHNlYXJjaDpzdHJpbmcpID0+IHtcclxuICAgICAgICByZXR1cm4gc3RyLnNsaWNlKGluZGV4LCBpbmRleCArIHNlYXJjaC5sZW5ndGgpID09PSBzZWFyY2g7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBQaWNrZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyB1cGRhdGUob3B0aW9uczpJT3B0aW9ucykge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
